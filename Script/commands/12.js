const schedule = require('node-schedule');
const axios = require('axios');
const moment = require('moment-timezone');
require('moment-duration-format'); // ржПржЯрж┐ ржЖржкржЯрж╛ржЗржо ржлрж░ржорзНржпрж╛ржЯрзЗрж░ ржЬржирзНржп ржкрзНрж░рзЯрзЛржЬржи

module.exports.config = {
  name: 'autosent',
  version: '26.0.0',
  hasPermssion: 0,
  credits: 'Belal x Gemini',
  description: 'ржЕржЯрзЛржорзЗржЯрж┐ржХ ржкрзНрж░рждрж┐ ржШржгрзНржЯрж╛рзЯ ржЖржкржбрзЗржЯ ржУ ржкрж╛ржУрзЯрж╛рж░ржлрзБрж▓ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕',
  commandCategory: 'system',
  usages: '[]',
  cooldowns: 2
};

const quotes = {
  0: "ржоржзрзНржпрж░рж╛ржд: ржирж┐рж╕рзНрждржмрзНржз ржкрзГржерж┐ржмрзАрждрзЗ 'ржЪрж╛ржБржжрзЗрж░ ржкрж╛рж╣рж╛рзЬ' ржЖржкржирж╛рж░ ржЕрждржирзНржжрзНрж░ ржкрзНрж░рж╣рж░рзА! ЁЯМЩ",
  1: "рж░рж╛ржд рззржЯрж╛: ржирж┐рж░рзНржЬржирждрж╛ ржирждрзБржи рж╕рзНржмржкрзНржирзЗрж░ ржмрзАржЬ ржмржкржи ржХрж░рзЗред рж╢рзБржн рж░рж╛рждрзНрж░рж┐ред тЬи",
  2: "рж░рж╛ржд рзиржЯрж╛: рждрж╛рж░рж╛рж░ ржорзЗрж▓рж╛рзЯ рж╕рзНржмржкрзНржиржЧрзБрж▓рзЛ ржбрж╛ржирж╛ ржорзЗрж▓рзБржХ ржмрж╕рзЗрж░ ржЫрж╛рзЯрж╛рзЯред ЁЯТд",
  3: "рж░рж╛ржд рзйржЯрж╛: рж╢рзЗрж╖ рж░рж╛рждрзЗрж░ ржкрзНрж░рж╛рж░рзНржержирж╛ ржЖрждрзНржорж╛рж░ ржкрж░ржо ржкрзНрж░рж╢рж╛ржирзНрждрж┐ред ЁЯд▓",
  4: "ржнрзЛрж░ рзкржЯрж╛: ржЕржирзНржзржХрж╛рж░рзЗрж░ рж╢рзЗрж╖рзЗржЗ ржЖрж▓рзЛрж░ ржирждрзБржи ржорж┐ржЫрж┐рж▓рзЗ рж╕рзНржмрж╛ржЧрждржоред ЁЯМЕ",
  5: "ржнрзЛрж░ рзлржЯрж╛: рж╕рзНржирж┐ржЧрзНржз рж╕ржХрж╛рж▓рзЗрж░ рж░рж╛ржЬржХрзАрзЯ рж╕рзНржкрж░рзНрж╢рзЗ ржжрж┐ржиржЯрж┐ рж░ржЩрж┐ржи рж╣рзЛржХред ЁЯМ╕",
  6: "рж╕ржХрж╛рж▓ рзмржЯрж╛: рж╕рзЛржирж╛рж▓рзА ржЖржнрж╛ ржЖржкржирж╛рж░ ржЬрзАржмржирзЗ ржЖржнрж┐ржЬрж╛рждрзНржп ржирж┐рзЯрзЗ ржЖрж╕рзБржХред тШАя╕П",
  7: "рж╕ржХрж╛рж▓ рзнржЯрж╛: ржирждрзБржи ржЙржжрзНржпржорзЗ ржжрж┐ржиржЯрж┐ рж╢рзБрж░рзБ рж╣рзЛржХ ржжрж╛ржкржЯрзЗрж░ рж╕рж╛ржерзЗред тШХЁЯФе",
  8: "рж╕ржХрж╛рж▓ рзоржЯрж╛: рж╕ржорзЯрзЗрж░ рж╕рзНрж░рзЛрждрзЗ ржирж┐ржЬрзЗржХрзЗ ржЙржЬрж╛рзЬ ржХрж░рзЗ ржжрж┐ржи, ржЬрзЯ ржирж┐рж╢рзНржЪрж┐рждред тП▒я╕П",
  9: "рж╕ржХрж╛рж▓ рзпржЯрж╛: ржмрзНржпрж╕рзНрждрждрж╛рж░ ржорж╛ржЭрзЗржУ 'ржЪрж╛ржБржжрзЗрж░ ржкрж╛рж╣рж╛рзЬ' ржЖржкржирж╛рж░ ржкрж╛рж╢рзЗ ржЖржЫрзЗред ЁЯЫ░я╕П",
  10: "рж╕ржХрж╛рж▓ рззрзжржЯрж╛: ржарзЛржБржЯрзЗрж░ ржХрзЛржгрзЗ рж╣рж╛рж╕рж┐ рж░рзЗржЦрзЗ ржЬрзЯрзЗрж░ ржирзЗрж╢рж╛рзЯ ржорзЗрждрзЗ ржЙржарзБржиред ЁЯШК",
  11: "рж╕ржХрж╛рж▓ рззрззржЯрж╛: рж░рзЛржж ржмрж╛рзЬржЫрзЗ, рж╕рж╛ржерзЗ ржмрж╛рзЬржЫрзЗ ржЖржкржирж╛рж░ рж╕ржлрж▓рждрж╛рж░ рждрзЗржЬред ЁЯСС",
  12: "ржжрзБржкрзБрж░ рззрзиржЯрж╛: ржоржзрзНржпржЧржЧржгрзЗ рж╕рзВрж░рзНржпрзЗрж░ ржорждрзЛ ржЙржЬрзНржЬрзНржмрж▓ ржерж╛ржХрзБржХ ржЖржкржирж╛рж░ ржорзЗржзрж╛ред ЁЯТО",
  13: "ржжрзБржкрзБрж░ рззржЯрж╛: рж▓рж╛ржЮрзНржЪ ржмрзНрж░рзЗржХ! ржкрзЗржЯ ржкрзБржЬрзЛржЯрж╛ рж╣рзЛржХ ржПржХржжржо рж░рж╛ржЬржХрзАрзЯред ЁЯН▒",
  14: "ржжрзБржкрзБрж░ рзиржЯрж╛: ржЕржмрж╕рж╛ржж ржЭрзЗрзЬрзЗ рж▓ржХрзНрж╖рзНржпрзЗ ржЕржмрж┐ржЪрж▓ ржерж╛ржХрж╛рж░ рж╕рж╛рж╣рж╕ ржкрж╛ржиред ЁЯЪА",
  15: "ржмрж┐ржХрзЗрж▓ рзйржЯрж╛: ржкрзЬржирзНржд рж░рзЛржжрзЗ ржЖржкржирж╛рж░ ржоржирзЗрж░ ржХрзНржпрж╛ржиржнрж╛рж╕ рж░ржЩрж┐ржи рж╣рзЛржХред ЁЯНГ",
  16: "ржмрж┐ржХрзЗрж▓ рзкржЯрж╛: ржЪрж╛рзЯрзЗрж░ ржХрж╛ржкрзЗ ржЖржбрзНржбрж╛ ржЬржорзБржХ ржмрж╕рзЗрж░ рж╢рзАрждрж▓ рж╣рж╛ржУрзЯрж╛рзЯред тШХ",
  17: "ржмрж┐ржХрзЗрж▓ рзлржЯрж╛: ржЧрзЛржзрзВрж▓рж┐рж░ ржЖржХрж╛рж╢ ржмрж▓ржЫрзЗтАФ ржжрж┐ржирзЗрж░ рж╢рзЗрж╖рзЗ ржЬрзЯ ржЖржкржирж╛рж░ржЗред ЁЯОи",
  18: "рж╕ржирзНржзрзНржпрж╛ рзмржЯрж╛: ржХрзНрж▓рж╛ржирзНрждрж┐ ржорзБржЫрзЗ ржШрж░рзЗ ржЖрж╕рзБржХ рж╕рзНржмрж░рзНржЧрзАрзЯ рж╢рж╛ржирзНрждрж┐ред ЁЯПа",
  19: "рж╕ржирзНржзрзНржпрж╛ рзнржЯрж╛: ржорзЗржзрж╛ ржЬрзНржмрж▓рзЗ ржЙржарзБржХ ржЬрзЛржирж╛ржХрж┐рж░ рж╕рзНржирж┐ржЧрзНржз ржЖрж▓рзЛрзЯред ЁЯТб",
  20: "рж░рж╛ржд рзоржЯрж╛: ржкрзНрж░рж┐рзЯржЬржиржжрзЗрж░ рж╕рж╛ржирзНржирж┐ржзрзНржпрзЗ ржХрж╛ржЯрзБржХ ржнрж╛рж▓рзЛржмрж╛рж╕рж╛рж░ ржорзБрж╣рзВрж░рзНрждред тЭдя╕П",
  21: "рж░рж╛ржд рзпржЯрж╛: ржбрж┐ржирж╛рж░рзЗрж░ рждрзГржкрзНрждрж┐ ржЖрж░ рж░рж╛рждрзЗрж░ рж╢рж╛ржирзНрждрж┐рждрзЗ рж╣рж╛рж░рж┐рзЯрзЗ ржпрж╛ржиред ЁЯНЫ",
  22: "рж░рж╛ржд рззрзжржЯрж╛: ржХрж╛ржЬ рж╢рзЗрж╖? ржПржмрж╛рж░ ржирж┐ржЬрзЗржХрзЗ рж╕ржорзЯ ржжрзЗржУрзЯрж╛рж░ рж░рж╛ржЬржХрзАрзЯ рж╕ржорзЯред ЁЯОз",
  23: "рж░рж╛ржд рззрззржЯрж╛: рждрзГржкрзНрждрж┐рж░ рж╢рзНржмрж╛рж╕ ржирж┐рзЯрзЗ ржмрж▓рзБржитАФ 'ржЖржЬ ржЖржорж┐ рж╕рзЗрж░рж╛ржЯрж╛ ржжрж┐рзЯрзЗржЫрж┐'ред ЁЯПЖ"
};

const startTime = Date.now();

module.exports.onLoad = async ({ api }) => {
  const rule = new schedule.RecurrenceRule();
  rule.tz = 'Asia/Dhaka';
  rule.minute = 0; // ржкрзНрж░рждрж┐ ржШржгрзНржЯрж╛рж░ рж╢рзБрж░рзБрждрзЗ ржХрж╛ржЬ ржХрж░ржмрзЗ

  schedule.scheduleJob(rule, async () => {
    try {
      const now = moment().tz('Asia/Dhaka');
      const time = now.format('hh:mm A');
      const date = now.format('DD/MM/YYYY');
      const hour = now.hour();

      // ЁЯМбя╕П Weather System (Kurigram/Rowmari)
      let weather = "Signal Weak ЁЯУб";
      try {
        const res = await axios.get(`https://api.openweathermap.org/data/2.5/weather?lat=25.8103&lon=89.6487&units=metric&appid=e38b33e1d689b0284980484b9071060b`);
        weather = `${Math.round(res.data.main.temp)}┬░C | ${res.data.weather[0].main}`;
      } catch (e) { }

      // ЁЯХЛ Prayer Times
      let prayers = "Updating...";
      try {
        const pr = await axios.get(`https://api.aladhan.com/v1/timingsByCity?city=Kurigram&country=Bangladesh&method=2`);
        const p = pr.data.data.timings;
        prayers = `F:${p.Fajr} D:${p.Dhuhr} A:${p.Asr} M:${p.Maghrib} I:${p.Isha}`;
      } catch (e) { }

      // ЁЯЪА Power Stats
      const uptime = moment.duration(Date.now() - startTime).format("D[d] H[h] m[m] s[s]");
      const ram = (process.memoryUsage().heapUsed / 1024 / 1024).toFixed(1);
      
      const msg = `ЁЯТа ЁЭЧиЁЭЧЯЁЭЧзЁЭЧеЁЭЧФ-ЁЭЧбЁЭЧШЁЭЧз ЁЭЧЯЁЭЧЬЁЭЧйЁЭЧШ ЁЯЫ░я╕П\nтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБ\nЁЯХТ ЁЭЧзЁЭЧ╢ЁЭЧ║ЁЭЧ▓: ${time} | ${date}\nЁЯУН ЁЭЧЯЁЭЧ╝ЁЭЧ░: Kurigram, Rowmari\nЁЯМбя╕П ЁЭЧкЁЭШБЁЭЧ╡ЁЭЧ┐: ${weather}\nтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБ\nЁЯУЬ ЁЭЧаЁЭЧжЁЭЧЪ: ${quotes[hour]}\nтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБ\nЁЯХЛ ЁЭЧгЁЭЧ┐ЁЭЧоЁЭШЖ: ${prayers}\nЁЯЪА ЁЭЧеЁЭЧФЁЭЧа: ${ram} MB | тЪб ЁЭЧиЁЭЧ╜: ${uptime}\nтЬЕ ЁЭЧжЁЭШБЁЭЧоЁЭШБЁЭШВЁЭША: Optimal Performance\nтФДтФЙтЭИтЬбя╕ПтЛЖтГЭржЪрж╛ржБржжрзЗржбрж╝~ржкрж╛рж╣рж╛ржбрж╝тЬ┐тГЭЁЯкмтЭИтФЙтФД`;

      const allThreads = global.data.allThreadID || [];
      console.log(`[AUTOSENT] Sending updates to ${allThreads.length} threads.`);

      for (const threadID of allThreads) {
        // ржмржЯрзЗрж░ ржирж┐ржЬрзЗрж░ ржЖржЗржбрж┐рждрзЗ ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛ржмрзЗ ржирж╛
        if (threadID != api.getCurrentUserID()) {
           api.sendMessage(msg, threadID, (err) => {
              if (err) console.log(`[AUTOSENT] Error in thread ${threadID}`);
           });
           await new Promise(res => setTimeout(res, 500)); // рж╕рзНржкрзНржпрж╛ржо ржПрзЬрж╛рждрзЗ ржПржХржЯрзБ ржЧрзНржпрж╛ржк
        }
      }
    } catch (err) {
      console.error("[AUTOSENT ERROR]", err);
    }
  });
};

module.exports.run = async ({ api, event }) => {
  return api.sendMessage("ржорж╛рж╕рзНржЯрж╛рж░ ржмрзЗрж▓рж╛рж▓, ржПржЯрж┐ ржПржХржЯрж┐ ржЕржЯрзЛржорзЗржЯрж┐ржХ ржоржбрж┐ржЙрж▓ред ржкрзНрж░рждрж┐ ржШржгрзНржЯрж╛рж░ рж╢рзБрж░рзБрждрзЗ ржПржЯрж┐ ржирж┐ржЬрзЗ ржерзЗржХрзЗржЗ ржЖржкржбрзЗржЯ ржкрж╛ржарж╛ржмрзЗред", event.threadID);
};
